<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Investimentos BB</title>
    
    <!-- Estilos (Tailwind CSS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM (Vers√£o 17 - Est√°vel) -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (Compilador) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; }
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 200ms; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- DADOS ---
        const BB_CDB_PRODUCTS = [
            { id: 'cdb_di_1800', name: 'BB CDB DI (1800 dias)', type: 'POS', days: 1800, ratePercent: 98.5, minVal: 500.00, liquidity: true, liquidityText: 'Com Liquidez Di√°ria' },
            { id: 'cdb_pre_60', name: 'BB CDB Prefixado (60 dias)', type: 'PRE', days: 60, rate: 12.6833, minVal: 500.00, liquidity: false, liquidityText: 'Sem Liquidez' },
            { id: 'cdb_pre_360', name: 'BB CDB Prefixado (360 dias)', type: 'PRE', days: 360, rate: 12.65826, minVal: 500.00, liquidity: false, liquidityText: 'Sem Liquidez' }
        ];

        const BB_LCI_PRODUCTS = [
            { id: 'lca_pre_370', name: 'BB LCA Prefixada (370 dias)', type: 'PRE', days: 370, rate: 9.73, minVal: 0.01, liquidity: false, liquidityText: 'Sem Liquidez' },
            { id: 'lca_pos_360', name: 'BB LCA P√≥s CDI Sem Resgate (360 dias)', type: 'POS', days: 360, ratePercent: 78, minVal: 0.01, liquidity: true, liquidityText: 'Com Liquidez' },
            { id: 'lca_pos_720', name: 'BB LCA P√≥s CDI Sem Resgate (720 dias)', type: 'POS', days: 720, ratePercent: 78, minVal: 0.01, liquidity: false, liquidityText: 'Sem Liquidez' },
            { id: 'lci_pos_1082', name: 'BB LCI P√≥s CDI (1082 dias)', type: 'POS', days: 1082, ratePercent: 78, minVal: 0.01, liquidity: true, liquidityText: 'Com Liquidez' }
        ];

        const BASE_STOCKS_DATA = [
            { symbol: "ABEV3", name: "Ambev S.A." }, { symbol: "ALPA4", name: "Alpargatas" }, { symbol: "AMER3", name: "Americanas" },
            { symbol: "ASAI3", name: "Assa√≠" }, { symbol: "AZUL4", name: "Azul" }, { symbol: "B3SA3", name: "B3" },
            { symbol: "BBAS3", name: "Banco do Brasil" }, { symbol: "BBDC3", name: "Bradesco (ON)" }, { symbol: "BBDC4", name: "Bradesco (PN)" },
            { symbol: "BBSE3", name: "BB Seguridade" }, { symbol: "BEEF3", name: "Minerva" }, { symbol: "BPAC11", name: "BTG Pactual" },
            { symbol: "BRAP4", name: "Bradespar" }, { symbol: "BRFS3", name: "BRF" }, { symbol: "BRKM5", name: "Braskem" },
            { symbol: "CCRO3", name: "CCR" }, { symbol: "CIEL3", name: "Cielo" }, { symbol: "CMIG4", name: "Cemig" },
            { symbol: "CMIN3", name: "CSN Minera√ß√£o" }, { symbol: "COGN3", name: "Cogna" }, { symbol: "CPFE3", name: "CPFL" },
            { symbol: "CPLE6", name: "Copel" }, { symbol: "CRFB3", name: "Carrefour" }, { symbol: "CSAN3", name: "Cosan" },
            { symbol: "CSNA3", name: "CSN" }, { symbol: "CVCB3", name: "CVC" }, { symbol: "CYRE3", name: "Cyrela" },
            { symbol: "DXCO3", name: "Dexco" }, { symbol: "ECOR3", name: "EcoRodovias" }, { symbol: "EGIE3", name: "Engie" },
            { symbol: "ELET3", name: "Eletrobras (ON)" }, { symbol: "ELET6", name: "Eletrobras (PNB)" }, { symbol: "EMBR3", name: "Embraer" },
            { symbol: "ENBR3", name: "EDP Brasil" }, { symbol: "ENEV3", name: "Eneva" }, { symbol: "ENGI11", name: "Energisa" },
            { symbol: "EQTL3", name: "Equatorial" }, { symbol: "EZTC3", name: "EZTEC" }, { symbol: "FLRY3", name: "Fleury" },
            { symbol: "GGBR4", name: "Gerdau" }, { symbol: "GOAU4", name: "Met. Gerdau" }, { symbol: "GOLL4", name: "Gol" },
            { symbol: "HAPV3", name: "Hapvida" }, { symbol: "HYPE3", name: "Hypera" }, { symbol: "IGTI11", name: "Iguatemi" },
            { symbol: "IRBR3", name: "IRB Brasil" }, { symbol: "ITSA4", name: "Ita√∫sa" }, { symbol: "ITUB4", name: "Ita√∫ Unibanco" },
            { symbol: "JBSS3", name: "JBS" }, { symbol: "JHSF3", name: "JHSF" }, { symbol: "KLBN11", name: "Klabin" },
            { symbol: "LREN3", name: "Lojas Renner" }, { symbol: "LWSA3", name: "Locaweb" }, { symbol: "MGLU3", name: "Magalu" },
            { symbol: "MRFG3", name: "Marfrig" }, { symbol: "MRVE3", name: "MRV" }, { symbol: "MULT3", name: "Multiplan" },
            { symbol: "NTCO3", name: "Natura" }, { symbol: "PCAR3", name: "P√£o de A√ß√∫car" }, { symbol: "PETR3", name: "Petrobras (ON)" },
            { symbol: "PETR4", name: "Petrobras (PN)" }, { symbol: "PETZ3", name: "Petz" }, { symbol: "PRIO3", name: "PetroRio" },
            { symbol: "PSSA3", name: "Porto Seguro" }, { symbol: "RADL3", name: "Raia Drogasil" }, { symbol: "RAIL3", name: "Rumo" },
            { symbol: "RDOR3", name: "Rede D'Or" }, { symbol: "RENT3", name: "Localiza" }, { symbol: "SANB11", name: "Santander" },
            { symbol: "SBSP3", name: "Sabesp" }, { symbol: "SLCE3", name: "SLC Agr√≠cola" }, { symbol: "SOMA3", name: "Grupo Soma" },
            { symbol: "SUZB3", name: "Suzano" }, { symbol: "TAEE11", name: "Taesa" }, { symbol: "TIMS3", name: "TIM" },
            { symbol: "TOTS3", name: "Totvs" }, { symbol: "UGPA3", name: "Ultrapar" }, { symbol: "USIM5", name: "Usiminas" },
            { symbol: "VALE3", name: "Vale" }, { symbol: "VBBR3", name: "Vibra" }, { symbol: "VIVT3", name: "Vivo" },
            { symbol: "WEGE3", name: "WEG" }, { symbol: "YDUQ3", name: "YDUQS" },
            { symbol: "BOVA11", name: "ETF Ibovespa" }, { symbol: "IVVB11", name: "ETF S&P500" }, { symbol: "SMAL11", name: "ETF Small Caps" },
            { symbol: "BCFF11", name: "FII BTG FOF" }, { symbol: "HGLG11", name: "FII CSHG Log" }, { symbol: "KNCR11", name: "FII Kinea" },
            { symbol: "KNRI11", name: "FII Kinea Renda" }, { symbol: "MXRF11", name: "FII Maxi Renda" }, { symbol: "VISC11", name: "FII Vinci Shop" },
            { symbol: "XPLG11", name: "FII XP Log" }, { symbol: "XPML11", name: "FII XP Malls" }
        ].sort((a, b) => a.symbol.localeCompare(b.symbol));

        const CURRENCY_PAIRS = "USD-BRL,EUR-BRL,GBP-BRL,ARS-BRL,COP-BRL,PEN-BRL,BOB-BRL,ILS-BRL";
        const CURRENCY_DETAILS = {
            USD: { name: "D√≥lar Americano", flag: "üá∫üá∏", country: "EUA / Equador" },
            EUR: { name: "Euro", flag: "üá™üá∫", country: "Uni√£o Europeia" },
            GBP: { name: "Libra Esterlina", flag: "üá¨üáß", country: "Reino Unido" },
            ARS: { name: "Peso Argentino", flag: "üá¶üá∑", country: "Argentina" },
            COP: { name: "Peso Colombiano", flag: "üá®üá¥", country: "Col√¥mbia" },
            PEN: { name: "Sol Peruano", flag: "üáµüá™", country: "Peru" },
            BOB: { name: "Boliviano", flag: "üáßüá¥", country: "Bol√≠via" },
            ILS: { name: "Novo Shekel", flag: "üáÆüá±", country: "Israel" }
        };

        const Icons = {
            TrendingUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
            DollarSign: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            Calculator: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            Briefcase: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            Alert: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            Info: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>,
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            ArrowUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m5 12 7-7 7 7"/><path d="M12 19V5"/></svg>,
            ArrowDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>,
            Lock: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            WifiOff: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="1" x2="23" y1="1" y2="23"/><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.58 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" x2="12.01" y1="20" y2="20"/></svg>,
            Wifi: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" x2="12.01" y1="20" y2="20"/></svg>,
            List: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>,
            Percent: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" x2="5" y1="5" y2="19"/><circle cx="6.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="17.5" r="2.5"/></svg>,
            Globe: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
            Exchange: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 2.1l4 4-4 4"/><path d="M3 11h16"/><path d="M7 21.9l-4-4 4-4"/><path d="M21 13H5"/></svg>,
            Star: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-yellow-400"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            Target: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
        };

        // --- COMPONENTES ---
        const Card = ({ children, className = "" }) => <div className={`bg-white rounded-xl shadow-md border border-gray-100 p-6 ${className}`}>{children}</div>;
        const Button = ({ children, onClick, active, className = "" }) => (
            <button onClick={onClick} className={`px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 ${active ? 'bg-blue-600 text-white shadow-lg transform scale-105' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'} ${className}`}>{children}</button>
        );
        const InputGroup = ({ label, value, onChange, type = "number", prefix, suffix, step = "1", helpText, disabled }) => (
            <div className="mb-4">
                <label className="block text-sm font-semibold text-gray-700 mb-1 flex items-center gap-2">{label}{helpText && <div className="group relative ml-1 cursor-help"><Icons.Info /><div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 bg-gray-800 text-white text-xs rounded hidden group-hover:block z-10">{helpText}</div></div>}</label>
                <div className="relative">
                    {prefix && <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">{prefix}</span>}
                    <input type={type} value={value} onChange={(e) => onChange(e.target.value)} step={step} disabled={disabled} className={`w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all ${prefix ? 'pl-8' : ''} ${suffix ? 'pr-8' : ''} ${disabled ? 'bg-gray-100 cursor-not-allowed' : ''}`} />
                    {suffix && <span className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">{suffix}</span>}
                </div>
            </div>
        );

        // --- COMPONENTE VISUAL DO ATIVO ---
        const StockCard = ({ stock, isMock, isSelected, showRecommendation = true }) => {
            const isUp = stock.change >= 0;
            const previousPrice = stock.previousClose ? stock.previousClose : (stock.price / (1 + (stock.change / 100)));
            
            // TERM√îMETRO T√âCNICO (Individual para o ativo)
            const recommendation = useMemo(() => {
                if (stock.change > 2.0) return { text: "Tend√™ncia de Alta Forte", color: "text-green-700 bg-green-100", icon: "üî•" };
                if (stock.change > 0.5) return { text: "Tend√™ncia de Alta", color: "text-green-600 bg-green-50", icon: "‚úÖ" };
                if (stock.change < -2.0) return { text: "Tend√™ncia de Baixa Forte", color: "text-red-700 bg-red-100", icon: "‚ùÑÔ∏è" };
                if (stock.change < -0.5) return { text: "Tend√™ncia de Baixa", color: "text-red-600 bg-red-50", icon: "üîª" };
                return { text: "Neutro / Lateral", color: "text-gray-700 bg-gray-100", icon: "‚öñÔ∏è" };
            }, [stock.change]);

            return (
                <div className={`bg-white border rounded-lg p-6 flex flex-col items-center justify-between hover:shadow-lg transition-all relative overflow-hidden ${isSelected ? 'border-blue-500 ring-2 ring-blue-500 transform scale-105 z-10' : (isMock ? 'border-yellow-200' : 'border-green-200')}`}>
                    {isMock ? (<div className="absolute top-0 right-0 bg-yellow-100 text-yellow-800 text-[10px] px-2 py-0.5 rounded-bl font-bold border-l border-b border-yellow-200 shadow-sm">MODO DEMO</div>) : (<div className="absolute top-0 right-0 bg-green-100 text-green-800 text-[10px] px-2 py-0.5 rounded-bl font-bold border-l border-b border-green-200 shadow-sm flex items-center gap-1"><div className="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div> AO VIVO</div>)}
                    
                    <div className="flex flex-col w-full mb-3 pt-2 items-center text-center">
                        <span className="font-bold text-2xl text-gray-800">{stock.symbol}</span>
                        <span className="text-xs text-gray-500 bg-gray-100 px-3 py-1 rounded-full mt-1 truncate max-w-full" title={stock.name}>{stock.name}</span>
                    </div>
                    
                    <div className="text-3xl font-bold text-gray-900 mb-1">R$ {stock.price?.toFixed(2)}</div>
                    <div className={`flex items-center gap-1 text-lg font-bold mb-4 ${isUp ? 'text-green-600' : 'text-red-600'}`}>
                        {isUp ? <Icons.ArrowUp /> : <Icons.ArrowDown />}{stock.change?.toFixed(2)}%
                    </div>
                    
                    {/* Exibe term√¥metro apenas se for o card principal selecionado */}
                    {showRecommendation && (
                        <div className={`w-full py-2 px-3 rounded mb-3 text-xs font-bold text-center flex justify-center items-center gap-2 ${recommendation.color}`}>
                            <span>{recommendation.icon}</span> {recommendation.text}
                        </div>
                    )}

                    <div className="text-xs text-gray-400 mb-4">Fechamento Ant.: R$ {previousPrice.toFixed(2)}</div>
                    <div className="w-full pt-3 border-t border-gray-100 text-xs text-gray-500 flex justify-between"><span>Lote: 100</span><span>M√≠n: R$ {(stock.price * 100).toFixed(0)}</span></div>
                    <div className="w-full mt-2 text-xs text-blue-600 text-center bg-blue-50 py-1.5 rounded font-medium">Fracion√°rio ({stock.symbol}F): 1 unid.</div>
                </div>
            );
        };

        const CurrencyCard = ({ code, data }) => {
            if (!data) return null;
            const info = CURRENCY_DETAILS[code] || { name: code, flag: "üè≥Ô∏è", country: "" };
            const isUp = parseFloat(data.pctChange) >= 0;
            return (
                <div className="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all relative overflow-hidden">
                    <div className="flex justify-between items-start mb-2"><div className="flex items-center gap-2"><span className="text-2xl">{info.flag}</span><div><h3 className="font-bold text-gray-800 text-lg leading-tight">{code}</h3><p className="text-[10px] text-gray-500 uppercase font-semibold">{info.name}</p></div></div><div className={`text-xs font-bold px-2 py-1 rounded ${isUp ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{isUp ? '+' : ''}{data.pctChange}%</div></div>
                    <div className="mt-3"><p className="text-gray-400 text-xs">Cota√ß√£o Comercial (Venda)</p><p className="text-2xl font-bold text-gray-900">R$ {parseFloat(data.ask).toFixed(4)}</p></div>
                    <div className="mt-2 pt-2 border-t border-gray-100 text-xs text-gray-500 flex justify-between"><span>Compra: R$ {parseFloat(data.bid).toFixed(4)}</span><span>{info.country}</span></div>
                </div>
            );
        };

        // --- SafeChart ---
        const SafeChart = ({ data, formatCurrency }) => {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);
            useEffect(() => {
                if (canvasRef.current) {
                    const ctx = canvasRef.current.getContext('2d');
                    if (chartRef.current) chartRef.current.destroy();
                    chartRef.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.map(d => d.mesLabel),
                            datasets: [
                                { label: 'Valor Acumulado', data: data.map(d => d.valor), borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', borderWidth: 3, fill: true, tension: 0.3 },
                                { label: 'Total Investido', data: data.map(d => d.investido), borderColor: '#9ca3af', borderWidth: 2, borderDash: [5, 5], fill: false, tension: 0 }
                            ]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false },
                            scales: { x: { title: { display: true, text: 'Tempo (Meses)', font: { size: 12, weight: 'bold' } }, grid: { display: false } }, y: { title: { display: true, text: 'R$', font: { size: 12, weight: 'bold' } }, ticks: { callback: (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(val) } } },
                            plugins: { tooltip: { callbacks: { title: (ctx) => `M√™s ${ctx[0].label}`, label: (ctx) => `${ctx.dataset.label}: ${formatCurrency(ctx.parsed.y)}` } } }
                        }
                    });
                }
                return () => { if (chartRef.current) chartRef.current.destroy(); };
            }, [data]);
            return <canvas ref={canvasRef} style={{ width: '100%', height: '100%' }} />;
        };

        // --- APP PRINCIPAL ---
        function InvestmentSimulator() {
            const [activeTab, setActiveTab] = useState('simulator');
            const [investmentType, setInvestmentType] = useState('POUPANCA');
            
            // Estados Gerais
            const [initialValue, setInitialValue] = useState(1000);
            const [monthlyContribution, setMonthlyContribution] = useState(0);
            const [years, setYears] = useState(2);
            const [startDate, setStartDate] = useState(new Date().toISOString().split('T')[0]);
            
            // Produtos
            const [selectedCdb, setSelectedCdb] = useState(BB_CDB_PRODUCTS[0]);
            const [selectedLci, setSelectedLci] = useState(BB_LCI_PRODUCTS[0]);

            // Taxas
            const [selicRate, setSelicRate] = useState(10.75);
            const [trRate, setTrRate] = useState(0.05);
            const [loadingRates, setLoadingRates] = useState(false);

            // A√ß√µes (Estados Separados)
            const [selectedStock, setSelectedStock] = useState(null); // O ativo que o usu√°rio escolheu
            const [suggestedStocks, setSuggestedStocks] = useState([]); // A lista de Top 5
            const [loadingStocks, setLoadingStocks] = useState(false);
            const [apiToken, setApiToken] = useState(""); 
            const [isUsingMock, setIsUsingMock] = useState(true);
            const [errorMessage, setErrorMessage] = useState("");
            const [availableOptions, setAvailableOptions] = useState(BASE_STOCKS_DATA);
            const [selectedTicker, setSelectedTicker] = useState("PETR4");

            // Moedas
            const [currencies, setCurrencies] = useState({});
            const [loadingCurrencies, setLoadingCurrencies] = useState(false);
            const [currencyCalcAmount, setCurrencyCalcAmount] = useState(1000);
            const [currencyCalcTarget, setCurrencyCalcTarget] = useState('USD');
            const [currencySpread, setCurrencySpread] = useState(4);
            const [currencyIOF, setCurrencyIOF] = useState(1.1);

            // Fetch Taxas
            useEffect(() => {
                const fetchData = async () => {
                    setLoadingRates(true);
                    try {
                        const [resSelic, resTr] = await Promise.all([ fetch('https://api.bcb.gov.br/dados/serie/bcdata.sgs.432/dados/ultimos/1?formato=json'), fetch('https://api.bcb.gov.br/dados/serie/bcdata.sgs.226/dados/ultimos/1?formato=json') ]);
                        const dataSelic = await resSelic.json();
                        const dataTr = await resTr.json();
                        if(dataSelic.length) setSelicRate(parseFloat(dataSelic[0].valor));
                        if(dataTr.length) setTrRate(parseFloat(dataTr[0].valor));
                    } catch(e) { console.error(e); } finally { setLoadingRates(false); }
                };
                fetchData();
            }, []);

            // Lista Completa se token
            useEffect(() => {
                if (apiToken && apiToken.length > 10) {
                   const fetchFullList = async () => {
                       try {
                           const response = await fetch(`https://brapi.dev/api/quote/list?sortBy=name&sortOrder=asc&token=${apiToken}`);
                           const data = await response.json();
                           if (data && data.stocks) setAvailableOptions(data.stocks.map(s => ({ symbol: s.stock, name: s.name })));
                       } catch (e) { console.log("Falha lista completa"); }
                   };
                   fetchFullList();
                }
            }, [apiToken]);

            // --- FETCH STOCKS SEPARADO ---
            const fetchStocks = async () => {
                setLoadingStocks(true);
                setErrorMessage(""); 
                
                // --- MODO DEMONSTRA√á√ÉO (SEM TOKEN) ---
                if (!apiToken) {
                    setIsUsingMock(true);
                    setTimeout(() => {
                        // Dados Mockados para Exemplo
                        const mockList = [
                            { symbol: "PETR4", name: "Petrobras (PN)", price: 38.50, change: 1.25, previousClose: 38.02 },
                            { symbol: "VALE3", name: "Vale (ON)", price: 62.10, change: -0.85, previousClose: 62.63 },
                            { symbol: "ITUB4", name: "Ita√∫ Unibanco (PN)", price: 33.40, change: 0.50, previousClose: 33.23 },
                            { symbol: "BBAS3", name: "Banco do Brasil (ON)", price: 27.90, change: 0.15, previousClose: 27.86 },
                            { symbol: "WEGE3", name: "WEG (ON)", price: 40.20, change: 2.10, previousClose: 39.37 },
                            { symbol: "BBDC4", name: "Bradesco (PN)", price: 14.30, change: -1.10, previousClose: 14.46 },
                        ];
                        
                        // 1. Define o ativo selecionado pelo usu√°rio (com seus dados espec√≠ficos)
                        const userPick = mockList.find(s => s.symbol === selectedTicker) || mockList[0];
                        setSelectedStock(userPick);

                        // 2. Define a lista de sugest√µes (Ordenada por maior alta)
                        const topMovers = [...mockList].sort((a, b) => b.change - a.change).slice(0, 5);
                        setSuggestedStocks(topMovers);

                        setLoadingStocks(false);
                    }, 500);
                    return;
                }

                // --- MODO REAL (COM TOKEN) ---
                setIsUsingMock(false);
                
                try {
                    // 1. Busca a a√ß√£o que o usu√°rio SELECIONOU (Foco Individual)
                    const responseSelected = await fetch(`https://brapi.dev/api/quote/${selectedTicker}?token=${apiToken}`);
                    const dataSelected = await responseSelected.json();
                    
                    if (dataSelected && (dataSelected.results || dataSelected.stocks)) {
                        const results = dataSelected.results || dataSelected.stocks;
                        setSelectedStock({
                            symbol: results[0].symbol,
                            name: results[0].longName || results[0].symbol,
                            price: results[0].regularMarketPrice,
                            change: results[0].regularMarketChangePercent,
                            previousClose: results[0].regularMarketPreviousClose
                        });
                    } else {
                        throw new Error(dataSelected.message || "Erro ao buscar ativo selecionado");
                    }

                    // 2. Tenta buscar a LISTA DE SUGEST√ïES (Top Movers) separadamente
                    // Nota: Se falhar (limite de API), n√£o quebra o app, apenas avisa na √°rea de sugest√µes
                    try {
                        const responseList = await fetch(`https://brapi.dev/api/quote/list?sortBy=change&sortOrder=desc&limit=5&token=${apiToken}`);
                        const dataList = await responseList.json();
                        if (dataList && dataList.stocks) {
                            setSuggestedStocks(dataList.stocks.map(s => ({
                                symbol: s.stock,
                                name: s.name,
                                price: s.close,
                                change: s.change,
                                previousClose: 0 // Simplificado para lista
                            })));
                        }
                    } catch (listError) {
                        console.warn("N√£o foi poss√≠vel buscar lista de destaques (prov√°vel limite de API):", listError);
                        setSuggestedStocks([]); // Deixa lista vazia para n√£o mostrar dados falsos
                    }

                } catch (error) {
                    setErrorMessage(`Erro: ${error.message || "Verifique o Token."}`);
                    setIsUsingMock(true); // Volta para seguran√ßa
                } finally { 
                    setLoadingStocks(false); 
                }
            };

            // Moedas
            const fetchCurrencies = async () => {
                setLoadingCurrencies(true);
                try {
                    const response = await fetch(`https://economia.awesomeapi.com.br/last/${CURRENCY_PAIRS}`);
                    const data = await response.json();
                    const normalized = {};
                    Object.keys(data).forEach(key => { normalized[data[key].code] = data[key]; });
                    setCurrencies(normalized);
                } catch (error) { console.error(error); } finally { setLoadingCurrencies(false); }
            };

            useEffect(() => { if (activeTab === 'stocks') fetchStocks(); }, [activeTab]);
            useEffect(() => { if (activeTab === 'currencies') fetchCurrencies(); }, [activeTab]);

            // Simulation Logic (Igual)
            const simulationResult = useMemo(() => {
                let data = [], finalVal = 0, totalInvested = 0, taxRate = 0, isExempt = false, isValid = true, warningMsg = "";
                const selicMensal = Math.pow(1 + selicRate / 100, 1 / 12) - 1, cdiMensal = Math.pow(1 + (selicRate - 0.10) / 100, 1 / 12) - 1, trDecimal = trRate / 100;

                if (investmentType === 'POUPANCA') {
                    const months = years * 12; let cur = parseFloat(initialValue), inv = parseFloat(initialValue); isExempt = true;
                    let tax = selicRate > 8.5 ? 0.005 + trDecimal : (selicMensal * 0.7) + trDecimal;
                    data.push({ mesLabel: '0', valor: cur, investido: inv });
                    for (let i = 1; i <= months; i++) { cur *= (1 + tax); const ap = parseFloat(monthlyContribution); if (ap > 0 && i < months) { cur += ap; inv += ap; } data.push({ mesLabel: i.toString(), valor: cur, investido: inv }); }
                    finalVal = cur; totalInvested = inv;
                } else if (investmentType === 'LCI_LCA') {
                    if (initialValue < selectedLci.minVal) { isValid = false; warningMsg = `M√≠nimo R$ ${selectedLci.minVal}`; } else {
                        const months = Math.ceil(selectedLci.days / 30); let cur = parseFloat(initialValue); isExempt = true;
                        let rate = selectedLci.type === 'PRE' ? Math.pow(1 + selectedLci.rate / 100, 1 / 12) - 1 : cdiMensal * (selectedLci.ratePercent / 100);
                        data.push({ mesLabel: '0', valor: cur, investido: cur });
                        for (let i = 1; i <= months; i++) { cur *= (1 + rate); data.push({ mesLabel: i.toString(), valor: cur, investido: parseFloat(initialValue) }); }
                        finalVal = cur; totalInvested = parseFloat(initialValue);
                    }
                } else if (investmentType === 'CDB') {
                    if (initialValue < selectedCdb.minVal) { isValid = false; warningMsg = `M√≠nimo R$ ${selectedCdb.minVal}`; } else {
                        const months = Math.ceil(selectedCdb.days / 30); let cur = parseFloat(initialValue);
                        let rate = selectedCdb.type === 'PRE' ? Math.pow(1 + selectedCdb.rate / 100, 1 / 12) - 1 : cdiMensal * (selectedCdb.ratePercent / 100);
                        if (selectedCdb.days <= 180) taxRate = 22.5; else if (selectedCdb.days <= 360) taxRate = 20.0; else if (selectedCdb.days <= 720) taxRate = 17.5; else taxRate = 15.0;
                        data.push({ mesLabel: '0', valor: cur, investido: cur });
                        for (let i = 1; i <= months; i++) { cur *= (1 + rate); data.push({ mesLabel: i.toString(), valor: cur, investido: parseFloat(initialValue) }); }
                        finalVal = cur; totalInvested = parseFloat(initialValue);
                    }
                }
                let gross = finalVal - totalInvested; let taxV = isExempt ? 0 : gross * (taxRate / 100);
                return { data, totalInvested, finalVal, netVal: finalVal - taxV, taxVal: taxV, taxRate, isExempt, isValid, warningMsg };
            }, [investmentType, initialValue, monthlyContribution, years, selectedLci, selectedCdb, selicRate, trRate]);

            const formatCurrency = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);
            const maturityDate = useMemo(() => { if(investmentType === 'POUPANCA') return null; const d = new Date(startDate); d.setDate(d.getDate() + (investmentType === 'LCI_LCA' ? selectedLci.days : selectedCdb.days)); return d.toLocaleDateString('pt-BR'); }, [startDate, investmentType, selectedLci, selectedCdb]);

            return (
                <div className="min-h-screen bg-gray-50 pb-12">
                    <header className="bg-blue-900 text-white p-6 shadow-lg">
                        <div className="max-w-6xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-3"><div className="text-yellow-400"><Icons.DollarSign /></div><div><h1 className="text-2xl font-bold">Simulador Banco do Brasil</h1><p className="text-blue-200 text-sm">Vers√£o Estudante: Produtos Reais</p></div></div>
                            <div className="text-right text-xs md:text-sm"><p>Selic Atual: <strong>{loadingRates ? '...' : selicRate + '%'}</strong></p><p>TR Atual (Mensal): <strong>{loadingRates ? '...' : trRate + '%'}</strong></p></div>
                        </div>
                    </header>
                    <main className="max-w-6xl mx-auto p-4 md:p-6">
                        <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
                            <Button active={activeTab === 'simulator'} onClick={() => setActiveTab('simulator')}><Icons.Calculator /> Simulador</Button>
                            <Button active={activeTab === 'stocks'} onClick={() => setActiveTab('stocks')}><Icons.Briefcase /> A√ß√µes (B3)</Button>
                            <Button active={activeTab === 'currencies'} onClick={() => setActiveTab('currencies')}><Icons.Globe /> C√¢mbio</Button>
                            <Button active={activeTab === 'learn'} onClick={() => setActiveTab('learn')}><Icons.BookOpen /> Aprenda</Button>
                        </div>

                        {activeTab === 'simulator' && (
                            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                                <div className="lg:col-span-4 space-y-4">
                                    <Card>
                                        <h3 className="font-bold text-lg mb-4 text-blue-900 border-b pb-2">1. Escolha a Modalidade</h3>
                                        <div className="flex flex-col gap-2">
                                            <button onClick={() => setInvestmentType('POUPANCA')} className={`p-3 rounded text-left font-medium border ${investmentType === 'POUPANCA' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-700 border-gray-200 hover:bg-gray-50'}`}>Poupan√ßa</button>
                                            <button onClick={() => setInvestmentType('LCI_LCA')} className={`p-3 rounded text-left font-medium border ${investmentType === 'LCI_LCA' ? 'bg-green-600 text-white border-green-600' : 'bg-white text-gray-700 border-gray-200 hover:bg-gray-50'}`}>LCI / LCA (Isento IR)</button>
                                            <button onClick={() => setInvestmentType('CDB')} className={`p-3 rounded text-left font-medium border ${investmentType === 'CDB' ? 'bg-purple-600 text-white border-purple-600' : 'bg-white text-gray-700 border-gray-200 hover:bg-gray-50'}`}>CDB (Com/Sem Liquidez)</button>
                                        </div>
                                    </Card>
                                    <Card>
                                        <h3 className="font-bold text-lg mb-4 text-blue-900 border-b pb-2">2. Configura√ß√£o</h3>
                                        {investmentType === 'POUPANCA' && (<div className="space-y-4 animate-fade-in"><div className="bg-blue-50 p-3 rounded text-sm text-blue-800 mb-4 flex gap-2"><Icons.Info /> <span>Simula√ß√£o livre: Voc√™ define valores e taxas.</span></div><InputGroup label="Valor Inicial" prefix="R$" value={initialValue} onChange={setInitialValue} /><InputGroup label="Aporte Mensal" prefix="R$" value={monthlyContribution} onChange={setMonthlyContribution} /><InputGroup label="Prazo (Anos)" value={years} onChange={setYears} suffix="anos" /><div className="border-t pt-4 mt-4"><h4 className="text-xs font-bold text-gray-500 mb-2 uppercase">Cen√°rio de Taxas (Edit√°vel)</h4><InputGroup label="Selic Prevista (% a.a.)" value={selicRate} onChange={setSelicRate} suffix="%" step="0.1" /><InputGroup label="TR Prevista (% a.m.)" value={trRate} onChange={setTrRate} suffix="%" step="0.01" /></div></div>)}
                                        {investmentType === 'LCI_LCA' && (<div className="space-y-4"><div className="bg-green-50 p-3 rounded text-sm text-green-800 mb-4 flex gap-2"><Icons.Info /> <span>Produtos reais BB. Par√¢metros fixos.</span></div><label className="block text-sm font-bold text-gray-700 mb-1">Produto BB</label><select className="w-full p-2 border rounded mb-4 text-sm" value={selectedLci.id} onChange={(e) => setSelectedLci(BB_LCI_PRODUCTS.find(p => p.id === e.target.value))}>{BB_LCI_PRODUCTS.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}</select><InputGroup label="Valor a Investir" prefix="R$" value={initialValue} onChange={setInitialValue} helpText={`M√≠nimo: R$ ${selectedLci.minVal}`} /><div className="bg-gray-100 p-3 rounded border text-xs space-y-1"><div className="flex justify-between"><span>Taxa:</span> <strong>{selectedLci.type === 'PRE' ? selectedLci.rate + '%' : selectedLci.ratePercent + '% CDI'}</strong></div><div className="flex justify-between"><span>Prazo:</span> <strong>{selectedLci.days} dias</strong></div><div className="flex justify-between"><span>Liquidez:</span> <strong className={selectedLci.liquidity ? 'text-green-600' : 'text-red-600'}>{selectedLci.liquidity ? 'SIM' : 'N√ÉO'}</strong></div></div><label className="block text-sm font-bold text-gray-700 mt-2">Data In√≠cio</label><input type="date" value={startDate} onChange={(e) => setStartDate(e.target.value)} className="w-full p-2 border rounded" /></div>)}
                                        {investmentType === 'CDB' && (<div className="space-y-4"><div className="bg-purple-50 p-3 rounded text-sm text-purple-800 mb-4 flex gap-2"><Icons.Info /> <span>Produtos reais BB. M√≠nimo R$ 500.</span></div><label className="block text-sm font-bold text-gray-700 mb-1">Produto BB</label><select className="w-full p-2 border rounded mb-4 text-sm" value={selectedCdb.id} onChange={(e) => setSelectedCdb(BB_CDB_PRODUCTS.find(p => p.id === e.target.value))}>{BB_CDB_PRODUCTS.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}</select><InputGroup label="Valor a Investir" prefix="R$" value={initialValue} onChange={setInitialValue} helpText="M√≠nimo obrigat√≥rio: R$ 500,00" />{!simulationResult.isValid && (<div className="bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded relative text-xs font-bold flex items-center gap-2"><Icons.Alert />{simulationResult.warningMsg}</div>)}<div className="bg-gray-100 p-3 rounded border text-xs space-y-1"><div className="flex justify-between"><span>Taxa:</span> <strong>{selectedCdb.type === 'PRE' ? selectedCdb.rate + '%' : selectedCdb.ratePercent + '% CDI'}</strong></div><div className="flex justify-between"><span>Prazo:</span> <strong>{selectedCdb.days} dias</strong></div><div className="flex justify-between"><span>Liquidez:</span> <strong className={selectedCdb.liquidity ? 'text-green-600' : 'text-red-600'}>{selectedCdb.liquidity ? 'SIM' : 'N√ÉO'}</strong></div></div><label className="block text-sm font-bold text-gray-700 mt-2">Data In√≠cio</label><input type="date" value={startDate} onChange={(e) => setStartDate(e.target.value)} className="w-full p-2 border rounded" /></div>)}
                                    </Card>
                                </div>
                                <div className="lg:col-span-8 space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <Card className="border-l-4 border-l-gray-400 bg-gray-50"><div className="text-gray-500 text-xs uppercase font-bold">Investido</div><div className="text-xl font-bold text-gray-800">{formatCurrency(simulationResult.totalInvested)}</div></Card>
                                        <Card className="border-l-4 border-l-blue-500 bg-blue-50"><div className="text-blue-500 text-xs uppercase font-bold">Bruto Final</div>{simulationResult.isValid ? (<div className="text-xl font-bold text-blue-900">{formatCurrency(simulationResult.finalVal)}</div>) : <div className="text-xl text-gray-400">---</div>}</Card>
                                        <Card className="border-l-4 border-l-green-500 bg-green-50 relative"><div className="text-green-600 text-xs uppercase font-bold">L√≠quido (No Bolso)</div>{simulationResult.isValid ? (<><div className="text-2xl font-bold text-green-900">{formatCurrency(simulationResult.netVal)}</div>{!simulationResult.isExempt && <div className="text-[10px] text-red-500 font-bold mt-1">- IR ({simulationResult.taxRate}%): {formatCurrency(simulationResult.taxVal)}</div>}{simulationResult.isExempt && <div className="text-[10px] text-green-600 font-bold mt-1">ISENTO DE IR</div>}</>) : <div className="text-2xl text-gray-400">---</div>}</Card>
                                    </div>
                                    <Card><div className="flex justify-between items-center mb-6"><div><h3 className="font-bold text-gray-700">Evolu√ß√£o do Patrim√¥nio</h3>{maturityDate && <p className="text-xs text-gray-500">Proje√ß√£o at√© vencimento: {maturityDate}</p>}</div></div><div className="h-[350px] w-full">{simulationResult.isValid ? (<SafeChart data={simulationResult.data} formatCurrency={formatCurrency} />) : (<div className="h-full flex items-center justify-center text-gray-400 text-sm">Corrija os valores para ver o gr√°fico.</div>)}</div></Card>
                                </div>
                            </div>
                        )}

                        {activeTab === 'stocks' && (
                            <div className="space-y-6">
                                <div className={`bg-gradient-to-r ${isUsingMock ? 'from-gray-800 to-gray-900' : 'from-blue-900 to-green-900'} p-6 rounded-xl text-white shadow-lg transition-colors duration-500`}>
                                    <div className="flex flex-col xl:flex-row justify-between items-center gap-4">
                                        <div><h2 className="text-2xl font-bold flex items-center gap-2"><Icons.Briefcase /> Painel da Bolsa (B3)</h2><p className="text-blue-200 text-sm mt-1 flex items-center gap-2">Status: {isUsingMock ? <span className="bg-yellow-500/20 text-yellow-300 px-2 py-0.5 rounded text-xs font-bold flex items-center gap-1 border border-yellow-500/30"><Icons.WifiOff /> SIMULA√á√ÉO (DEMO)</span> : <span className="bg-green-500/20 text-green-300 px-2 py-0.5 rounded text-xs font-bold flex items-center gap-1 border border-green-500/30"><Icons.Wifi /> CONECTADO (DADOS REAIS)</span>}</p></div>
                                        <div className="flex flex-col md:flex-row items-center gap-2 w-full xl:w-auto">
                                            <div className="relative w-full md:w-64 text-gray-900"><div className="absolute inset-y-0 left-0 flex items-center pl-2 pointer-events-none text-gray-500"><Icons.List /></div><select value={selectedTicker} onChange={(e) => setSelectedTicker(e.target.value)} className="w-full pl-8 pr-3 py-2 rounded text-sm font-medium border-2 border-transparent focus:border-blue-400 outline-none appearance-none bg-white cursor-pointer">{availableOptions.map(s => (<option key={s.symbol} value={s.symbol}>{s.symbol} {s.symbol === s.name ? '' : ` - ${s.name.substring(0, 25)}`}</option>))}</select></div>
                                            <input type="text" value={apiToken} onChange={(e) => setApiToken(e.target.value)} placeholder="Token Brapi (Opcional)" className="px-3 py-2 rounded text-gray-900 text-sm w-full md:w-56 border-2 border-transparent focus:border-blue-400 outline-none" />
                                            <Button onClick={fetchStocks} className="bg-blue-600 hover:bg-blue-500 text-white py-2 w-full md:w-auto justify-center">{loadingStocks ? '...' : 'Atualizar'}</Button>
                                        </div>
                                    </div>
                                    {errorMessage && <div className="mt-4 bg-red-500/20 border border-red-500/50 p-3 rounded text-red-100 text-sm flex items-center gap-2 animate-pulse"><Icons.AlertCircle /><span>{errorMessage} (Exibindo dados de demonstra√ß√£o)</span></div>}
                                    {!apiToken && !errorMessage && <div className="mt-4 bg-gray-700/50 p-2 rounded border border-gray-600 text-xs flex items-center gap-2 text-gray-300"><Icons.Info /><span><strong>Dica:</strong> Para ver dados reais, insira um Token da Brapi. Sem token, usamos dados fict√≠cios para ensino.</span></div>}
                                </div>

                                {/* SE√á√ÉO 1: SUA AN√ÅLISE (√önico Ativo) */}
                                <div className="flex justify-center mt-6">
                                    <div className="w-full max-w-sm relative">
                                        <div className="absolute -top-3 left-1/2 -translate-x-1/2 bg-blue-100 text-blue-800 text-xs font-bold px-3 py-1 rounded-full border border-blue-200 z-20">
                                            Sua Sele√ß√£o
                                        </div>
                                        {loadingStocks ? (
                                            <div className="text-center py-12 text-gray-500">Buscando dados de {selectedTicker}...</div>
                                        ) : selectedStock ? (
                                            <StockCard stock={selectedStock} isMock={isUsingMock} isSelected={true} />
                                        ) : (
                                            <div className="text-center py-8 text-gray-400">Clique em Atualizar para ver os dados.</div>
                                        )}
                                    </div>
                                </div>

                                {/* SE√á√ÉO 2: SUGEST√ïES DE MERCADO (Lista Separada) */}
                                <div className="mt-10 pt-6 border-t border-gray-200">
                                    <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                        <Icons.Target /> Maiores Altas do Dia (Sugest√µes)
                                    </h3>
                                    
                                    {suggestedStocks.length > 0 ? (
                                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                                            {suggestedStocks.map((stock) => (
                                                <StockCard key={stock.symbol} stock={stock} isMock={isUsingMock} showRecommendation={false} />
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="bg-gray-100 p-4 rounded text-center text-sm text-gray-500">
                                            {isUsingMock 
                                                ? "Carregando sugest√µes..." 
                                                : "N√£o foi poss√≠vel carregar a lista de sugest√µes (Token Gratuito limita a 1 consulta por vez). Foque na an√°lise individual acima."}
                                        </div>
                                    )}
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
                                    <Card><h3 className="text-xl font-bold mb-4 text-blue-900 flex items-center gap-2"><Icons.Search /> Como investir?</h3><div className="space-y-4"><div className="flex gap-3"><div className="bg-blue-100 p-2 rounded h-fit font-bold text-blue-700">1</div><div className="text-sm">Abra conta em corretora (Nubank, Inter, XP, etc).</div></div><div className="flex gap-3"><div className="bg-blue-100 p-2 rounded h-fit font-bold text-blue-700">2</div><div className="text-sm">Transfira o dinheiro via PIX.</div></div><div className="flex gap-3"><div className="bg-blue-100 p-2 rounded h-fit font-bold text-blue-700">3</div><div className="text-sm">No Home Broker, digite o c√≥digo (ex: {selectedTicker || 'PETR4'}F para fracion√°rio) e compre.</div></div></div></Card>
                                    <Card className="bg-gray-50 border-blue-200"><h3 className="text-xl font-bold mb-4 text-gray-800 flex items-center gap-2"><Icons.Lock /> Riscos e Liquidez</h3><ul className="space-y-3 text-sm text-gray-700"><li className="flex items-start gap-2"><span className="text-red-500 font-bold">‚Ä¢</span> Volatilidade: O pre√ßo varia todo dia.</li><li className="flex items-start gap-2"><span className="text-blue-500 font-bold">‚Ä¢</span> Liquidez D+2: O dinheiro do resgate demora 2 dias √∫teis.</li></ul></Card>
                                </div>
                            </div>
                        )}

                        {activeTab === 'currencies' && (
                            <div className="space-y-6">
                                <div className="bg-gradient-to-r from-teal-800 to-teal-900 p-6 rounded-xl text-white shadow-lg">
                                    <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                                        <div><h2 className="text-2xl font-bold flex items-center gap-2"><Icons.Globe /> C√¢mbio em Tempo Real</h2><p className="text-teal-200 text-sm mt-1">Cota√ß√µes oficiais (comerciais). Use a calculadora abaixo para estimar custos reais.</p></div>
                                        <div className="flex items-center gap-2"><Button onClick={fetchCurrencies} className="bg-teal-600 hover:bg-teal-500 text-white py-2">{loadingCurrencies ? 'Atualizando...' : 'Atualizar Agora'}</Button></div>
                                    </div>
                                </div>
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">{Object.keys(CURRENCY_DETAILS).map(code => (<CurrencyCard key={code} code={code} data={currencies[code]} />))}</div>
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-4">
                                    <Card>
                                        <h3 className="text-xl font-bold mb-4 text-teal-900 flex items-center gap-2"><Icons.Exchange /> Calculadora Real de Compra</h3>
                                        <div className="space-y-4">
                                            <InputGroup label="Valor em Reais (R$)" value={currencyCalcAmount} onChange={setCurrencyCalcAmount} />
                                            <div><label className="block text-sm font-semibold text-gray-700 mb-1">Moeda de Destino</label><select className="w-full p-2 border rounded" value={currencyCalcTarget} onChange={e => setCurrencyCalcTarget(e.target.value)}>{Object.keys(CURRENCY_DETAILS).map(c => <option key={c} value={c}>{c} - {CURRENCY_DETAILS[c].name}</option>)}</select></div>
                                            <InputGroup label="Spread da Casa de C√¢mbio (%)" value={currencySpread} onChange={setCurrencySpread} helpText="Taxa cobrada pela corretora acima do comercial (M√©dia: 3% a 5%)." />
                                            <div><label className="block text-sm font-semibold text-gray-700 mb-1">Tipo de IOF</label><div className="flex gap-4"><label className="flex items-center gap-2 cursor-pointer"><input type="radio" name="iof" checked={currencyIOF === 1.1} onChange={() => setCurrencyIOF(1.1)} /><span className="text-sm">Dinheiro (1,1%)</span></label><label className="flex items-center gap-2 cursor-pointer"><input type="radio" name="iof" checked={currencyIOF === 4.38} onChange={() => setCurrencyIOF(4.38)} /><span className="text-sm">Cart√£o (4,38%)</span></label></div></div>
                                            <div className="bg-teal-50 p-4 rounded-lg border border-teal-200 mt-4"><div className="text-sm text-gray-600 mb-1">Voc√™ Recebe Aproximadamente:</div><div className="text-3xl font-bold text-teal-900">{formatCurrency(currencyResult.result).replace('R$', '')} {currencyCalcTarget}</div><div className="text-xs text-gray-500 mt-2 pt-2 border-t border-teal-200">Custo Efetivo Total (CET): <strong>R$ {currencyResult.effectiveRate.toFixed(4)}</strong> por {currencyCalcTarget}</div></div>
                                        </div>
                                    </Card>
                                    <Card className="bg-gray-50 border-gray-200"><h3 className="text-xl font-bold mb-4 text-gray-800 flex items-center gap-2"><Icons.Info /> Entenda os Custos</h3><ul className="space-y-4 text-sm text-gray-700"><li className="flex gap-3"><div className="bg-blue-100 p-2 rounded h-fit font-bold text-blue-700">1</div><div><span className="font-bold block text-gray-900">Comercial vs Turismo</span>A cota√ß√£o que voc√™ v√™ no Google √© a "Comercial" (entre bancos). Pessoas f√≠sicas pagam a cota√ß√£o "Turismo", que inclui custos operacionais e margem de lucro.</div></li><li className="flex gap-3"><div className="bg-blue-100 p-2 rounded h-fit font-bold text-blue-700">2</div><div><span className="font-bold block text-gray-900">Spread (√Ågio)</span>√â a "gordura" que a casa de c√¢mbio cobra. Pode variar de 1% (contas digitais globais) a 8% (aeroportos). Pesquise bem!</div></li><li className="flex gap-3"><div className="bg-blue-100 p-2 rounded h-fit font-bold text-blue-700">3</div><div><span className="font-bold block text-gray-900">IOF (Imposto)</span>Comprar papel moeda paga 1,1% de imposto. Usar cart√£o de cr√©dito ou pr√©-pago internacional paga 4,38% (em transi√ß√£o para reduzir at√© 2028).</div></li></ul></Card>
                                </div>
                            </div>
                        )}

                        {activeTab === 'learn' && (
                            <div className="space-y-8">
                                <div className="bg-white p-6 rounded-xl shadow-md border-l-4 border-green-500">
                                    <h2 className="text-2xl font-bold text-green-800 mb-4 flex items-center gap-2"><Icons.DollarSign /> LCI e LCA (Letras de Cr√©dito)</h2>
                                    <div className="grid md:grid-cols-2 gap-6 mb-6">
                                        <div>
                                            <h3 className="font-bold text-gray-800 mb-2">Entendendo o Produto</h3>
                                            <p className="text-gray-600 text-sm mb-3">No Banco do Brasil, ao contratar uma LCI ou LCA, voc√™ est√° adquirindo um produto com data de validade definida (Vencimento). O valor que voc√™ deposita hoje render√° at√© essa data espec√≠fica.</p>
                                            <h3 className="font-bold text-gray-800 mb-2">Regras de Ouro</h3>
                                            <ul className="text-sm text-gray-700 space-y-2">
                                                <li><span className="text-green-600 font-bold">ISENTO DE IR:</span> Todo o lucro que aparece na tela √© seu. O governo n√£o morde nada.</li>
                                                <li><span className="font-bold">Aporte √önico:</span> Voc√™ n√£o consegue "adicionar mais dinheiro" na mesma aplica√ß√£o semana que vem. Se quiser investir mais, ter√° que contratar uma NOVA LCI com a taxa do dia.</li>
                                            </ul>
                                        </div>
                                        <div className="bg-green-50 p-4 rounded-lg">
                                            <h3 className="font-bold text-green-900 mb-2">O que significa "Sem Liquidez"?</h3>
                                            <p className="text-sm text-gray-700 mb-2">Significa que seu dinheiro est√° <strong>TRANCADO</strong> at√© o dia do vencimento. Voc√™ n√£o consegue resgatar para uma emerg√™ncia. Por aceitar essa condi√ß√£o, o banco geralmente paga uma taxa melhor.</p>
                                            <p className="text-sm text-gray-700 mt-2"><strong>Dica:</strong> S√≥ invista em "Sem Liquidez" aquele dinheiro que voc√™ tem certeza absoluta que n√£o vai precisar usar nos pr√≥ximos anos.</p>
                                        </div>
                                    </div>
                                    <h3 className="font-bold text-gray-800 mb-4 pt-4 border-t">Conhe√ßa as 4 Op√ß√µes Dispon√≠veis no Simulador</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">{BB_LCI_PRODUCTS.map(p => (<div key={p.id} className="border border-green-200 rounded p-4 bg-white shadow-sm hover:shadow-md transition-shadow"><div className="font-bold text-green-800 text-sm mb-2 h-10 flex items-center">{p.name}</div><ul className="text-xs text-gray-600 space-y-2"><li className="flex justify-between"><span>Prazo:</span> <strong>{p.days} dias</strong></li><li className="flex justify-between"><span>Taxa:</span> <strong>{p.type === 'PRE' ? p.rate + '%' : p.ratePercent + '% CDI'}</strong></li><li className="flex justify-between"><span>M√≠nimo:</span> <strong>R$ {p.minVal}</strong></li><li className={`font-bold mt-2 pt-2 border-t text-center ${p.liquidity ? 'text-green-600' : 'text-red-600'}`}>{p.liquidityText}</li></ul></div>))}</div>
                                </div>
                                <div className="bg-white p-6 rounded-xl shadow-md border-l-4 border-blue-500">
                                    <h2 className="text-2xl font-bold text-blue-800 mb-4 flex items-center gap-2"><Icons.TrendingUp /> CDB (Certificado de Dep√≥sito Banc√°rio)</h2>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div><h3 className="font-bold text-gray-800 mb-2">Vis√£o Geral</h3><p className="text-gray-600 text-sm mb-3">√â o "arroz com feij√£o" dos investimentos. Voc√™ empresta para o banco, e ele te paga juros. Diferente da LCI, aqui tem Imposto de Renda.</p><h3 className="font-bold text-gray-800 mb-2">Liquidez Di√°ria vs Vencimento</h3><ul className="text-sm text-gray-700 space-y-2 mb-3"><li><strong>Liquidez Di√°ria:</strong> Resgate a qualquer momento (dias √∫teis). Ideal para emerg√™ncias. Rende menos.</li><li><strong>Liquidez no Vencimento:</strong> Dinheiro preso at√© o fim. Rende mais.</li></ul></div>
                                        <div className="bg-blue-50 p-4 rounded-lg"><h3 className="font-bold text-blue-900 mb-2">Tabela Regressiva de IR (Sobre o Lucro)</h3><div className="grid grid-cols-2 gap-2 text-center text-xs"><div className="bg-white p-2 rounded border">At√© 180 dias<br/><span className="font-bold text-red-500">22,5%</span></div><div className="bg-white p-2 rounded border">181 a 360 dias<br/><span className="font-bold text-orange-500">20,0%</span></div><div className="bg-white p-2 rounded border">361 a 720 dias<br/><span className="font-bold text-yellow-600">17,5%</span></div><div className="bg-white p-2 rounded border">+720 dias<br/><span className="font-bold text-green-600">15,0%</span></div></div></div>
                                    </div>
                                    <h3 className="font-bold text-gray-800 mb-4 pt-4 border-t mt-4">Op√ß√µes Dispon√≠veis no Simulador (BB)</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">{BB_CDB_PRODUCTS.map(p => (<div key={p.id} className="border border-blue-200 rounded p-4 bg-white shadow-sm hover:shadow-md transition-shadow"><div className="font-bold text-blue-800 text-sm mb-2 h-10 flex items-center">{p.name}</div><ul className="text-xs text-gray-600 space-y-2"><li className="flex justify-between"><span>Prazo:</span> <strong>{p.days} dias</strong></li><li className="flex justify-between"><span>Taxa:</span> <strong>{p.type === 'PRE' ? p.rate + '%' : p.ratePercent + '% CDI'}</strong></li><li className="flex justify-between"><span>M√≠nimo:</span> <strong>R$ {p.minVal}</strong></li><li className={`font-bold mt-2 pt-2 border-t text-center ${p.liquidity ? 'text-green-600' : 'text-red-600'}`}>{p.liquidityText}</li></ul></div>))}</div>
                                </div>
                                <div className="bg-white p-6 rounded-xl shadow-md border-l-4 border-purple-500">
                                    <h2 className="text-2xl font-bold text-purple-800 mb-4 flex items-center gap-2"><Icons.Briefcase /> Bolsa de Valores (A√ß√µes)</h2>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div><h3 className="font-bold text-gray-800 mb-2">Ser S√≥cio, n√£o Credor</h3><p className="text-gray-600 text-sm mb-3">Diferente da Renda Fixa (onde voc√™ empresta dinheiro), aqui voc√™ compra um "pedacinho" da empresa. Se ela lucrar, voc√™ ganha (via dividendos ou valoriza√ß√£o da a√ß√£o). Se ela vai mal, sua a√ß√£o desvaloriza.</p><h3 className="font-bold text-gray-800 mb-2">Como Operar?</h3><ul className="text-sm text-gray-700 space-y-2 mb-3"><li>Use o <strong>Home Broker</strong> do seu banco.</li><li>Digite o c√≥digo (Ticker). Ex: <strong>VALE3</strong>.</li><li>Lote Padr√£o = 100 a√ß√µes. Fracion√°rio (1 a 99 a√ß√µes) = Adicione 'F' no final (<strong>VALE3F</strong>).</li></ul></div>
                                        <div className="bg-purple-50 p-4 rounded-lg"><h3 className="font-bold text-purple-900 mb-2">Riscos Reais</h3><ul className="text-sm text-gray-700 space-y-2"><li><strong>Oscila√ß√£o:</strong> √â normal ver seu patrim√¥nio cair num dia e subir no outro.</li><li><strong>Liquidez D+2:</strong> Vendeu hoje? O dinheiro s√≥ cai na conta em 2 dias √∫teis.</li></ul></div>
                                    </div>
                                </div>
                            </div>
                        )}
                        <footer className="mt-12 text-center text-gray-400 text-xs pb-4"><p>Fonte de Dados: API Banco Central do Brasil, Brapi.dev e AwesomeAPI.</p><p className="mt-1">Uso estritamente educacional.</p></footer>
                    </main>
                </div>
            );
        }

        ReactDOM.render(<InvestmentSimulator />, document.getElementById('root'));
    </script>
</body>
</html>